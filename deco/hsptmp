#include "gdi32.as"
#include "user32.as"
#include "obj.as"
#include "lib.hsp"
#include "lib3.hsp"


	var_53 = 0
	notesel var_35
	enoteload "config.csv"
	setconfigdata var_35
	var_54 = int("$" + loadconfig("ThemeColor1", "0x555555"))
	var_55 = int("$" + loadconfig("ThemeColor2", "0xCCCCCC"))
	var_56 = int("$" + loadconfig("ThemeColor3", "0x000000"))
	saveconfig "config.csv"
	var_57 = 0
	dimtype var_58, vartype("str")
	dimtype var_57, vartype("int")
	dimtype var_59, vartype("int")
	dimtype var_60, vartype("int")
	dimtype var_61, vartype("int")
	dimtype var_62, vartype("int")
	dimtype var_63, vartype("int")
	dimtype var_64, vartype("str")
	onexit *label_50
	buffer 0, 640, 640
	gmode 7, 32, 32
	pos 32, 0
	picload "image/button_add.bmp", 1
	pos 96, 0
	picload "image/button_del.bmp", 1
	pos 160, 0
	picload "image/button_front.bmp", 1
	color var_56 >> 16 & 255, var_56 >> 8 & 255, var_56 & 255
	boxf 0, 0, 32, 32
	boxf 64, 0, 96, 32
	boxf 128, 0, 160, 32
	color var_54 >> 16 & 255, var_54 >> 8 & 255, var_54 & 255
	boxf 0, 32, 160, 64
	pos -1, 32
	gcopy 0, 0, 0, 32, 32
	pos 63, 32
	gcopy 0, 64, 0, 32, 32
	pos 127, 32
	gcopy 0, 128, 0, 32, 32
	color var_55 >> 16 & 255, var_55 >> 8 & 255, var_55 & 255
	boxf 0, 64, 160, 96
	pos -1, 64
	gcopy 0, 0, 0, 32, 32
	pos 63, 64
	gcopy 0, 64, 0, 32, 32
	pos 127, 64
	gcopy 0, 128, 0, 32, 32
	color var_55 >> 16 & 255, var_55 >> 8 & 255, var_55 & 255
	boxf 0, 96, 160, 128
	pos -1, 96
	gcopy 0, 0, 0, 32, 32
	pos 63, 96
	gcopy 0, 64, 0, 32, 32
	pos 127, 96
	gcopy 0, 128, 0, 32, 32
	dirlist var_65, "memo/*.dat", 0
	if ( stat == 0 ) {
		var_66 = 1
		gosub *label_40
	}
	else {
		var_66 = 0
		notesel var_65
		repeat noteinfo(0)
			noteget var_67, cnt
			notesel var_35
			noteload "memo/" + var_67
			noteget var_68, 0
			split var_68, ",", var_69, var_70, var_71
			var_72 = ""
			repeat noteinfo(0) - 1, 1
				noteget var_68, cnt
				var_72 = var_72 + var_68
			loop
			noteunsel
			var_66 = 0
			var_64(ginfo(25)) = "memo/" + var_67
			gosub *label_40
			var_63(ginfo(3)) = int(var_71)
			var_58(ginfo(3)) = var_72
			width , , int(var_69), int(var_70)
			gsel ginfo(3), 1 + var_63(ginfo(3))
			objprm var_60(ginfo(3)), var_58(ginfo(3))
			end
		loop
		noteunsel
	}
	stop
*label_40
	bgscr ginfo(25), ginfo(20), ginfo(21), 2, ginfo(4) + 24, ginfo(5) + 24
	var_63(ginfo(3)) = var_53
	width 280, 220
	color var_54 >> 16 & 255, var_54 >> 8 & 255, var_54 & 255
	boxf
	color var_55 >> 16 & 255, var_55 >> 8 & 255, var_55 & 255
	boxf 1, 32, ginfo(12) - 2, ginfo(13) - 2
	objmode 2, 0
	font "ƒƒCƒŠƒI", 14
	pos 5, 32 + 5
	mesbox var_58(ginfo(3)), ginfo(12) - 10, ginfo(13) - 32 - 10, 1, 16777215
	var_60(ginfo(3)) = stat
	var_59(ginfo(3)) = objinfo(stat, 2)
	ShowScrollBar var_59(ginfo(3)), 3, 0
	SetWindowLong var_59(ginfo(3)), -20, 0
	SetWindowPos var_59(ginfo(3)), 0, 0, 0, 0, 0, 39
	CreateSolidBrush var_55
	var_73(ginfo(3)) = stat
	objsize 32, 32
	objimage 0, 0, 32, 0, 64, 0, 96
	pos 0, 0
	button gosub "", *label_42
	var_62(length(var_62)) = stat
	var_61(length(var_61)) = 1
	objimage 0, 64, 32, 64, 64, 64, 96
	pos ginfo(12) - 32, 0
	button gosub "", *label_42
	var_62(length(var_62)) = stat
	var_61(length(var_61)) = 2
	objimage 0, 128, 32, 128, 64, 128, 96
	pos ginfo(12) - 64, 0
	button gosub "", *label_42
	var_62(length(var_62)) = stat
	var_61(length(var_61)) = 3
	if ( var_66 ) {
		repeat
			var_64(ginfo(3)) = strf("memo/%04d%02d%02d%02d%02d%02d%02d.dat", gettime(0), gettime(1), gettime(3), gettime(4), gettime(5), gettime(6), cnt)
			exist var_64(ginfo(3))
			if ( strsize == (-1) ) {
				break
			}
			await 1
		loop
		gsel ginfo(3), 1 + var_63(ginfo(3))
	}
	var_57(ginfo(3)) = 1
	oncmd gosub *label_45, 307
	oncmd gosub *label_44, 5
	oncmd gosub *label_47, 513
	onkey gosub *label_48
	return
*label_41
	exist var_64(ginfo(3))
	if ( strsize != (-1) ) {
		delete var_64(ginfo(2))
	}
	gsel ginfo(3), -1
	var_63(ginfo(3)) = -1
	var_74 = 1
	repeat ginfo(25) - 1, 1
		if ( var_63(cnt) != (-1) ) {
			var_74 = 0
			gsel cnt, 0
			break
		}
	loop
	if ( var_74 ) {
		end
	}
	return
*label_42
	var_75 = stat
	foreach var_62
		if ( var_75 == var_62(cnt) ) {
			var_76 = var_61(cnt)
			if ( 0 ) {
				var_77++
			}
			if ( var_76 == 1 | var_77 ) {
				var_77 = 0
				var_66 = 1
				gosub *label_40
				goto *label_43
				var_77++
			}
			if ( var_76 == 2 | var_77 ) {
				var_77 = 0
				gosub *label_41
				goto *label_43
				var_77++
			}
			if ( var_76 == 3 | var_77 ) {
				var_77 = 0
				var_63(ginfo(3)) = var_63(ginfo(3)) == 0
				gsel ginfo(2), 1 + var_63(ginfo(3))
				gosub *label_46
				goto *label_43
			}
*label_43
			break
		}
	loop
	return
*label_44
	if ( var_57(ginfo(3)) == 0 ) {
		return
	}
	color var_54 >> 16 & 255, var_54 >> 8 & 255, var_54 & 255
	boxf
	color var_55 >> 16 & 255, var_55 >> 8 & 255, var_55 & 255
	boxf 0, 32, ginfo(12), ginfo(13)
	var_78 = ginfo(12) - 10, ginfo(13) - 32 - 10, 0, 0
	resizeobj var_60(ginfo(3)), var_78, 1
	gosub *label_46
	return
*label_45
	if ( ginfo(3) < 1 ) {
		return
	}
	if ( var_57(ginfo(3)) == 0 ) {
		return
	}
	 wparam, var_56
	 wparam, var_55
	repeat length(var_59) - 1, 1
		if ( var_59(cnt) == lparam ) {
			gsel cnt
			break
		}
	loop
	gosub *label_46
	return var_73(ginfo(3))
*label_46
	var_35 = strf("%d,%d,%d\n%s", ginfo(4), ginfo(5), var_63(ginfo(3)), var_58(ginfo(3)))
	notesel var_35
	notesave var_64(ginfo(3))
	noteunsel
	return
*label_47
	gsel ginfo(2), 0
	sendmsg hwnd, 161, 2, 0
	return
*label_48
	getkey var_79, 17
	if ( var_79 == 1 ) {
		var_76 = iparam
		if ( 0 ) {
			var_77++
		}
		if ( var_76 == 65 | var_77 ) {
			var_77 = 0
			sendmsg var_59(ginfo(3)), 177, 0, -1
			goto *label_49
		}
	}
*label_49
	return
*label_50
	foreach var_73
		DeleteObject var_73(cnt)
	loop
	end
